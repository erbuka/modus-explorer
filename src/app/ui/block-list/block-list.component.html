<ng-template #editBlockDialogTmpl let-data>
    <h2>Edit Link</h2>
    <div class="row">

        <div class="col-12">
            <app-file-input [item]="this.item" [(url)]="data.link.image"></app-file-input>
        </div>

        <mat-form-field class="col-12">
            <mat-label>Title</mat-label>
            <app-editable-localized-text [(data)]="data.link.title"></app-editable-localized-text>
        </mat-form-field>

        <mat-form-field class="col-12">
            <mat-label>Destination Item</mat-label>
            <mat-select [(ngModel)]="data.link.itemId">
                <mat-option *ngFor="let item of data.items | async" [value]="item.id">
                    <span>{{ item.id }}</span>
                    <span *ngIf="item.title">
                        ({{ item?.title | cnLocalizedText }})
                    </span> 
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>
</ng-template>
<ng-container *ngIf="item">
    <div class="d-flex h-100 p-4" *ngIf="!context.editorMode.value">
        <div class="d-flex flex-wrap justify-content-center cn-block-list m-auto">
            <div *ngFor="let l of item.links;index as i" class="cn-block-list-item p-1 animated fadeInRight"
                [style.animation-delay]="0.1 * i + 's'" [style.width]="item.options.itemWidth">
                <div class="cn-relative mat-elevation-z4"
                    [style.padding-bottom]="(1 / item.options.itemAspectRatio * 100) + '%'"
                    [routerLink]="['/', l.itemId]">
                    <div class="cn-overlay cn-bg-cover" [appBgImage]="l.image | cnUrl : item"></div>
                    <div class="cn-overlay cn-block-list-hover" style="background-color: rgba(0,0,0,.5);"></div>
                    <div class="cn-overlay d-flex align-items-end w-100">
                        <div class="cn-block-list-label m-0 flex-grow-1" [innerHTML]="l.title | cnLocalizedText"></div>
                    </div>
                </div>
            </div>

            <div *ngIf="context.editorMode.value" class="cn-block-list-item p-1 animated fadeInRight"
                [style.width]="item.options.itemWidth">
                <div class="cn-relative mat-elevation-z4" (click)="addLink()"
                    [style.padding-bottom]="(1 / item.options.itemAspectRatio * 100) + '%'">
                    <div class="cn-overlay d-flex align-items-center justify-content-center">
                        <mat-icon>add</mat-icon>
                    </div>
                    <div class="cn-overlay cn-block-list-hover" style="background-color: rgba(0,0,0,.5);"></div>
                </div>
            </div>

        </div>
    </div>

    <ng-container *ngIf="context.editorMode.value">
        <div class="d-flex w-100 h-100 align-items-center justify-content-center cn-editor-mode-context">
            <div class="cn-block-list-editor mat-elevation-z1" cdkDropList (cdkDropListDropped)="onLinkDropped($event)">
                <div *ngFor="let l of item.links;index as i" cdkDrag class="d-flex align-items-center px-3 py-2">
                    <button mat-icon-button (click)="item.links.splice(i, 1)">
                        <mat-icon>delete</mat-icon>
                    </button>
                    <button mat-icon-button (click)="editLink(l)">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button cdkDragHandle mat-icon-button >
                        <mat-icon>drag_handle</mat-icon>
                    </button>

                    <div [innerHTML]="l.title | cnLocalizedText"></div>
                </div>

                <div class="d-flex justify-content-center align-items-center px-3 py-2" (click)="addLink()">
                    <mat-icon>add</mat-icon>
                </div>

            </div>
        </div>
    </ng-container>

</ng-container>